<!DOCTYPE html>
<html lang="en">

<head>
	<title>Account Management</title>
	<link rel="icon" type="image/x-icon" href="/image/favicon/favicon.ico" />
	<link rel="stylesheet" type="text/css" href="/css/account/style.css" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta charset="UTF-8" />
	<meta name="description" content="Account management page for Typing Game." />
	<meta name="keywords" content="account, management, password, change" />
	<meta property="og:title" content="Account Management" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://typing-game.taroj1205.poyo.jp/account.html" />
	<meta property="og:description" content="Account management page for Typing Game." />
	<meta property="og:site_name" content="Typing Game" />
	<!-- TODO <meta property="og:image" content="" /> -->
	<meta name="twitter:card" content="summary_large_image" />
	<!-- TODO <meta name="twitter:image:src" content="" /> -->
	<meta name="twitter:site" content="@taroj1205">
	<meta name="twitter:creator" content="@taroj1205">
	<meta name="subject" content="Account management page for Typing Game." />
	<meta name="author" content="taroj1205" />
	<meta name="designer" content="taroj1205" />
</head>

<body>
	<div class="container">
		<h1 class="title">Account Management</h1>
		<form id="change-password-form">
			<label for="username">Username:</label>
			<input type="text" id="username" name="username" required>
			<label for="current-password">Current Password:</label>
			<input type="password" id="current-password" name="current-password" required>
			<label for="new-password">New Password:</label>
			<input type="password" id="new-password" name="new-password" required>
			<label for="confirm-password">Confirm Password:</label>
			<input type="password" id="confirm-password" name="confirm-password" required>
			<button type="button" id="change-password-button" disabled>Change Password</button>
		</form>
	</div>
	<script>
		const usernameInput = document.getElementById('username');
		const currentPasswordInput = document.getElementById('current-password');
		const newPasswordInput = document.getElementById('new-password');
		const confirmPasswordInput = document.getElementById('confirm-password');
		const changePasswordButton = document.getElementById('change-password-button');
		const changePasswordForm = document.getElementById('change-password-form');

	const showSuccessMessage = () => {
		const successMessage = document.createElement('div');
		successMessage.innerText = 'Password changed successfully.';
		successMessage.style.backgroundColor = 'green';
		successMessage.style.color = 'white';
		successMessage.style.padding = '10px';
		successMessage.style.borderRadius = '5px';
		successMessage.style.position = 'fixed';
		successMessage.style.top = '10px';
		successMessage.style.right = '10px';
		document.body.appendChild(successMessage);

		setTimeout(() => {
			successMessage.remove();
		}, 5000);
	};

	const checkPasswordsMatch = () => {
		const newPassword = newPasswordInput.value;
		const confirmPassword = confirmPasswordInput.value;
		if (newPassword === confirmPassword) {
			changePasswordButton.disabled = false;
		} else {
			changePasswordButton.disabled = true;
		}
	};

	newPasswordInput.addEventListener('input', checkPasswordsMatch);
	confirmPasswordInput.addEventListener('input', checkPasswordsMatch);

	changePasswordButton.addEventListener('click', async () => {
		const username = usernameInput.value;
		const currentPassword = currentPasswordInput.value;
		const newPassword = newPasswordInput.value;
		const confirmPassword = confirmPasswordInput.value;

		if (newPassword !== confirmPassword) {
			console.error('New passwords do not match');
			// Show an error message to the user
			const errorMessage = document.createElement('span');
			errorMessage.innerText = 'New passwords do not match.';
			errorMessage.style.color = 'red';
			document.body.appendChild(errorMessage);
			return;
		}

		const response = await fetch('/change-password', {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, currentPassword, newPassword })
		});
		const data = await response.json();

		if (data.success) {
			console.log('Password change successful!');
			showSuccessMessage();
			// Clear the form inputs
			changePasswordForm.reset();
		} else {
			console.error('Password change failed:', data.error);
			// Show an error message to the user
			const errorMessage = document.createElement('span');
			errorMessage.innerText = 'Password change failed.';
			errorMessage.style.color = 'red';
			document.body.appendChild(errorMessage);
		}
	});
	</script>
</body>

</html>